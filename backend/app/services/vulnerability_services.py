from sqlalchemy.orm import Session
from ..models.vulnerability import Vulnerability

# Returns all vulnerabilities from the database.
def list_vulnerabilities(db: Session):
    vulns = db.query(Vulnerability).all()
    return [
        {
            "id": vuln.id,
            "service_id": vuln.service_id,
            "template_id": vuln.template_id,
            "severity": vuln.severity,
            "description": vuln.description,
            "evidence": vuln.evidence,
        }
        for vuln in vulns
    ]

# Returns details of a single vulnerability from the database.
def vuln_detail(db: Session, vuln_id: int):
    vuln = db.query(Vulnerability).filter(Vulnerability.id == vuln_id).first()
    if not vuln:
        return None

    return {
        "id": vuln.id,
        "service_id": vuln.service_id,
        "template_id": vuln.template_id,
        "severity": vuln.severity,
        "description": vuln.description,
        "evidence": vuln.evidence,
    }

# Returns all vulnerabilities for a specific service.
def list_vulns_for_service(db: Session, service_id: int):
    vulns = db.query(Vulnerability).filter(Vulnerability.service_id == service_id).all()
    return [
        {
            "id": vuln.id,
            "service_id": vuln.service_id,
            "template_id": vuln.template_id,
            "severity": vuln.severity,
            "description": vuln.description,
            "evidence": vuln.evidence,
        }
        for vuln in vulns
    ]
